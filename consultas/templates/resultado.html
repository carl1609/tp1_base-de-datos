<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <link rel="stylesheet" href="{% static 'estilosBase.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <title>Aplicacion</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="titulo">
                <img src="logoPostgres.png" alt="logoPostgres">
            </div>
            <div class="elementos-header">
                <div class="elemento">
                    <!--PARTE II del lab3 (La PARTE I era lo del diccionario de datos asi q no entra)-->
                    <div class="abrir-menu" data-target="m1">
                        Obtener objetos del servidor
                    </div>
                    <div class="menu m1">
                        <!-- pongo todos en cero por ahora-->
                        <ul class="lista-opciones">
                            <li><a href="{% url 'resultados' 'consulta1' '0' %}">Obtener las bases de datos disponibles</a></li>
                            <li><a href="{% url 'resultados' 'consulta2' '0' %}">Obtener los Roles que se puede conectar al servidor</a></li>
                            <li><a href="{% url 'resultados' 'consulta3' '0' %}">Obtener los Grupos que existen en el servidor</a></li>
                            <li><a href="{% url 'resultados' 'consulta4' '0' %}">Obtener los lenguajes del servidor</a></li>
                        </ul>
                    </div>
                </div>
                <div class="elemento">
                    <!--PARTE III del lab3-->
                    <div class="abrir-menu" data-target="m2">
                        Obtener objetos de la BBDD
                    </div>
                    <div class="menu m2">
                        <ul class="lista-opciones">
                            <li><a href="{% url 'resultados' 'consulta5' '0' %}">Obtener los esquemas</a></li>
                            <li><a href="{% url 'resultados' 'consulta6' '0' %}">Obtener las tablas de un esquema</a></li>
                            <li><a href="{% url 'resultados' 'consulta7' '0' %}">Obtener las vistas</a></li>
                            <li><a href="{% url 'resultados' 'consulta8' '0' %}">Obtener las funciones</a></li>
                            <li><a href="{% url 'resultados' 'consulta9' '0' %}">Obtener los trigger</a></li>
                            <li><a href="{% url 'resultados' 'consulta10' '0' %}">Obtener las secuencias</a></li>
                            <li><a href="{% url 'resultados' 'consulta11' '0' %}">Obtener las reglas</a></li>
                            <li><a href="{% url 'resultados' 'consulta12' '0' %}">Obtener los tipos de datos</a></li>
                            <li><a href="{% url 'resultados' 'consulta13' '0' %}">Obtener índices</a></li>
                        </ul>
                    </div>
                </div>
                <div class="elemento">
                    <!--PARTE IV del lab3-->
                    <div class="abrir-menu" data-target="m3">
                        Obtener detalles de los objetos
                    </div>
                    <div class="menu m3">
                        <ul class="lista-opciones">
                            <li><a href="{% url 'resultados' 'consulta14' '0' %}">Detalles de los esquemas. <br>Obtener para un esquema los privilegios de acceso</a></li>
                            <li><a href="{% url 'resultados' 'consulta15' '0' %}">Obtener detalles de las tablas. <br>Orden de los campos, nombre y tipo de dato</a></li>
                            <li><a href="{% url 'resultados' 'consulta16' '0' %}">Obtener detalles de las tablas. Clave primaria</a></li>
                            <li><a href="{% url 'resultados' 'consulta17' '0' %}">Obtener detalles de las tablas. Clave foráneas</a></li>
                            <li><a href="{% url 'resultados' 'consulta18' '0' %}">Obtener detalles de las secuencias</a></li>
                            <li><a href="{% url 'resultados' 'consulta19' '0' %}">Obtener la definición de un índice</a></li>
                        </ul>
                    </div>
                </div>
                <div class="elemento">
                    <!--PARTE V del lab3-->
                    <div class="abrir-menu" data-target="m4">
                        Obtener detalles de privilegios de los objetos
                    </div>
                    <div class="menu m4">
                        <ul class="lista-opciones">
                            <li><a href="{% url 'resultados' 'consulta20' '0' %}">Obtener los privilegios de una tabla</a></li>
                            <li><a href="{% url 'resultados' 'consulta21' '0' %}">Obtener los privilegios de las funciones</a></li>
                        </ul>
                    </div>
                </div>
                <div class="elemento">
                    <!--PARTE VI del lab3-->
                    <div class="abrir-menu" data-target="m5">
                        Monitoreo
                    </div>
                    <div class="menu m5">
                        <ul class="lista-opciones">
                            <li><a href="{% url 'resultados' 'consulta22' '0' %}">Usuarios conectados, IP y consulta</a></li>
                            <li><a href="{% url 'resultados' 'consulta23' '0' %}">Tamaño de las bases de datos del servidor</a></li>
                            <li><a href="{% url 'resultados' 'consulta24' '0' %}">Tamaño de una tabla</a></li>
                            <li><a href="{% url 'resultados' 'consulta25' '0' %}">Tamaño de todas las tablas de un esquema</a></li>
                            <li><a href="{% url 'resultados' 'consulta26' '1' %}">Listado por BBDD del tamaño total de la BBDD, <br> el nombre del esquema, el nombre
                                de la tabla, <br> el tamaño total de la tabla, el tamaño de la tabla <br> y el tamaño del índice</a></li>
                        </ul>
                    </div>
                </div>
                <script src="{% static 'scriptMostrarMenu.js' %}"></script>
            </div>
        </header>
        
        
            <div class="contenido_2"> <!--NOTA: ESTO ES LO QUE VA A SER REEMPLAZADO POR CADA RESULTADO SEGUN EL ENLACE SELECCIONADO-->
                <section class="resultado">
                    <table>
                        <thead>
                            <tr>
                                {% for columna in columnas %}
                                    <th>{{ columna }}</th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for tupla in resultados %}
                                <tr>
                                    {% for dato in tupla  %}
                                        <td>{{dato}}</td>
                                    {% endfor %}            
            
                                </tr>
                            {% endfor %}    
                        </tbody>
                    </table>
            
                </section>
                <div class="content_grafico">
                   <canvas id="grafico"></canvas>
                </div>
            </div>
        
        <div class="final"> <!--ESTO PODRIA USARSE PARA CREDITOS: EJ: INTEGRANTES: (Y NUESTROS NOMBRES)-->

        </div>
    </div>
     <script> 


     /* otra manera de hacerlo f si se ve el grafico pero no me termina de convencer mañana lo trato de hacer 
     directamente con la tabla que no se me habia ocurrido 
         const hay_grafico={{grafico|safe}};
         const grafico=document.querySelector('#grafico');
        console.log(grafico)
        if(hay_grafico==1){
       
        const datos={{resultados|safe}};
           
            console.log(datos.length)
            
            const listas=[]
            const longitud=datos[0].length

            for (let i = 0; i < longitud; i++) {
                const tupla=[]
                for (const element of datos ) {
                    tupla.push(element[i])
                }
               listas.push(tupla)
            }
            console.log(listas)
            const labels={{columnas|safe}};
            const valor_prueba=[[123,121,212],[232,434,544]]
            
            
            const chart = new Chart(grafico, {
                type: 'bar',
                data: {
                    labels:{{columnas|safe}},
                    datasets: listas.map((lista) =>{
                        const lista_numeros = lista.map(elemento => {
                        const numeros = elemento.match(/\d+/g);
                        return numeros
                        });
                        const numeros_filtrados= lista_numeros.filter((elemento)=> elemento!==null)
                        console.log(numeros_filtrados)

                        datasets= {
                            label: 'tamaño',
                            data: numeros_filtrados,
                            borderColor: 'rgba(255, 99, 132, 1)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            borderWidth: 1
                        }
                        return datasets
                    })
                    
                    
                    
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'datos'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Valor'
                            },
                            beginAtZero: false
                        }
                    }
                }
            });
        } 
            */
    </script> 
</body>
</html>